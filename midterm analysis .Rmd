---
title: "midterm analysis"
author: "Jessie Chen"
date: "11/7/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
install.packages("psych")
install.packages("irr")
library("irr")
library(psych)
library(readr)
data_q1 <- read_csv("~/Downloads/Midterm_Schizophrenia (1).csv")
View(data_q1)
#Q1
data_q1_nona <- na.omit(data_q1)
Qs = c('sleep.quality', 'sleep.latency', 'sleep.duration', 'sleep.efficiency', 
       'sleep.disturbance', 'sleep.meds', 'sleep.daytime')
# psych can handle missing values, though not sure what algorithm it uses
alpha(data_q1_nona[Qs])

# Non missing response frequency for each item
#                      0    1    2    3 miss
# sleep.quality     0.12 0.49 0.31 0.08    0
# sleep.latency     0.49 0.21 0.30 0.00    0
# sleep.duration    0.65 0.14 0.09 0.11    0
# sleep.efficiency  0.51 0.22 0.12 0.14    0
# sleep.disturbance 0.39 0.54 0.06 0.00    0
# sleep.meds        0.68 0.03 0.02 0.27    0
# sleep.daytime     0.48 0.25 0.15 0.12    0

# Q2
# marital status
cohen.kappa(table(data_q1$maritald.patient, data_q1$maritald.family))
# Cohen Kappa and Weighted Kappa correlation coefficients and confidence boundaries 
#                  lower estimate upper
# unweighted kappa  0.93     0.96     1
# weighted kappa    0.93     0.96     1
#
# employment status
cohen.kappa(table(data_q1$employmentd.patient, data_q1$employmentd.family))
# Cohen Kappa and Weighted Kappa correlation coefficients and confidence boundaries 
#                  lower estimate upper
# unweighted kappa  0.95     0.98     1
# weighted kappa    0.95     0.98     1

#1.	What is the reliability of the patient and family reports of marital and employment status? Report and interpret the reliability coefficient.
#according to the result, the reliability coefficient for marital status is 0.96, and employment status is 0.98.
#1.	Based on your results, comment on whether or not patient self-report of these constructs should be used in a replication of this study.
#It should be used in a replication of this study because the estimate is high enough. ( larger than 0.7)

# Q3
# BMS: between mean square
# EMS: error mean square
# JMS: judge's mean square
# WMS: within mean square
data_q3 <- read_csv("~/Downloads/Midterm_PhD Program (1).csv")
View(data_q3)
install.packages("reshape")
library(reshape)
# add a column for subject id
data_q3$subject = rownames(data_q3)
# prepare data for anova
data_q3 <- as.data.frame(data_q3)
class(data_q3)
data_q3.anova <- melt(data_q3, id.vars=c('subject'), variable_name=c('prof'))
# class 1 model; only subjects contribute to the random effect; i.e. random 
# sampling of subjects, but raters have no errors
anova(lm(value ~ subject, data_q3.anova))
# Response: value
#            Df Sum Sq Mean Sq F value    Pr(>F)    
# subject   189 228.40 1.20844  1.4679 0.0009092 ***
# Residuals 380 312.83 0.82325                      
# ---
# Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
# we can get BMS and EMS from above
# interaction model assuming random effects
anova(lm(value ~ subject * prof, data_q3.anova))
#             Df  Sum Sq Mean Sq F value Pr(>F)
# subject      189 228.395  1.2084     NaN    NaN
# prof           2  19.659  9.8294     NaN    NaN
# subject:prof 378 293.175  0.7756     NaN    NaN
# Residuals      0   0.000     NaN  

# we can get BMS, JMS and WMS from above
# ICC(1,1) = (BMS - WMS) / (BMS+(k - 1)•WMS)
# ICC(2,1) = (BMS - EMS) / (BMS+(k - 1)•EMS+k•(JMS - EMS)/N)
# ICC(3,1) = (BMS - EMS) / (BMS+(k - 1)•EMS)
# ICC(1,k) <- (BMS - WMS) / BMS
# ICC(2,k) <- (BMS - EMS) / (BMS + ((JMS - EMS)/n))
# ICC(3,k) <- (BMS - EMS) / BMS

# ICC from psych package will calculate all models
rts = c("Professor1", "Professor2", "Professor3")
icc_res <- ICC(data_q3[rts])
icc_res
# Single_raters_absolute	ICC1	0.1349222	1.467896	189	380	0.0009092039	
# Single_random_raters	ICC2	0.1491240	1.558081	189	378	0.0001558288	
# Single_fixed_raters	ICC3	0.1568489	1.558081	189	378	0.0001558288	
# Average_raters_absolute	ICC1k	0.3187530	1.467896	189	380	0.0009092039	
# Average_random_raters	ICC2k	0.3445968	1.558081	189	378	0.0001558288	
# Average_fixed_raters	ICC3k	0.3581849	1.558081	189	378	0.0001558288	
rts = c("Professor1", "Professor2")
icc_res <- ICC(data_q3[rts])
icc_res
# Single_raters_absolute	ICC1	-0.028053598	0.9454239	189	190	0.6501076	
# Single_random_raters	ICC2	0.009338857	1.0203479	189	189	0.4450093	
# Single_fixed_raters	ICC3	0.010071500	1.0203479	189	189	0.4450093	
# Average_raters_absolute	ICC1k	-0.057726635	0.9454239	189	190	0.6501076	
# Average_random_raters	ICC2k	0.018504899	1.0203479	189	189	0.4450093	
# Average_fixed_raters	ICC3k	0.019942152	1.0203479	189	189	0.4450093
rts = c("Professor1", "Professor3")
icc_res <- ICC(data_q3[rts])
icc_res
# Single_raters_absolute	ICC1	0.4973165	2.978647	189	190	1.137283e-13	
# Single_random_raters	ICC2	0.4973165	2.978647	189	189	1.253961e-13	
# Single_fixed_raters	ICC3	0.4973165	2.978647	189	189	1.253961e-13	
# Average_raters_absolute	ICC1k	0.6642771	2.978647	189	190	1.137283e-13	
# Average_random_raters	ICC2k	0.6642771	2.978647	189	189	1.253961e-13	
# Average_fixed_raters	ICC3k	0.6642771	2.978647	189	189	1.253961e-13	

#We should drop professor 2 since it gives the worest icc scores.


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
